dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcSyncRepl
<% keyarray = [] -%>
<% rid = 0 -%>
<% @members.each do |member| -%>
<%   if scope.lookupvar('openldap::ldapcluster_member').has_key?(member) -%>
<%     scope.lookupvar('openldap::ldapcluster_member')[member].each do |ldapsrv| -%>
<%       if not(keyarray.include?(ldapsrv)) -%>
<%         keyarray.push(ldapsrv) -%>
<%         if scope.lookupvar('openldap::ldapcluster_srv').has_key?(ldapsrv) -%>
<%           ldapsrvhash = scope.lookupvar('openldap::ldapcluster_srv')[ldapsrv] -%>
<%           output = "olcSyncRepl: rid=%03d provider=ldap://%s binddn=\"cn=admin,cn=config\" bindmethod=simple credentials=%s searchbase=\"cn=config\" type=refreshAndPersist retry=\"5 5 300 5\" timeout=1\n" % [ rid += 1,ldapsrvhash["hostname"],ldapsrvhash["credentials"] ] -%>
<%=          output -%>
<%         end -%>
<%       end -%>
<%     end -%>
<%   end -%>
<% end -%>
-
add: olcMirrorMode
olcMirrorMode: TRUE
